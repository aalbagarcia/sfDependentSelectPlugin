/*
 *
 * This file is part of the sfDependentSelect package.
 * (c) 2010 Sergio Flores <sercba@gmail.com>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 *
 */
var SelectDependiente=function(a){if(this.instancias[a.id]instanceof SelectDependiente){return this.instancias[a.id]}this.instancias[a.id]=this;defecto={id:"",opciones:{},dependiente:"",vacio:false,ajax:false,cache:true,url:"",params:{},varref:"_ref",varsoloref:"_solo_ref"};for(var b in defecto){this[b]=typeof a[b]==="undefined"?defecto[b]:a[b]}if(typeof this.dependiente==="string"&&this.dependiente.length>0){this.dependiente=new SelectDependiente({id:this.dependiente})}this.grupo="";this.limpio=false;this.fnsCambio=[];this.select=document.getElementById(this.id);this.iniciar();return this};SelectDependiente.prototype.instancias=[];SelectDependiente.prototype.iniciar=function(){var a=this;for(var b in this.params){if(this.params[b]===null){this.params[b]=undefined}}this.select.onchange=function(){a.cambio(a.select.options[a.select.selectedIndex].value)};if(typeof this.dependiente==="object"){this.dependiente.agregarFnCambio(function(b){a.mostrar(b)})}var c=false;for(var b=0;b<this.select.options.length;b++){var d=this.select.options[b];if(typeof this.opciones["html"]==="undefined"){this.opciones.html={}}if(d.value==""){this.vacio=d.text}else{this.opciones["html"][d.value]=d.text}c=true}if(c===true){this.mostrar("html")}};SelectDependiente.prototype.agregarFnCambio=function(a){this.fnsCambio.push(a)};SelectDependiente.prototype.cambio=function(a){for(var b in this.fnsCambio){this.fnsCambio[b](a)}};SelectDependiente.prototype.agregarOpcion=function(a,b){var c=document.createElement("option");c.value=a;c.text=b;try{this.select.add(c,null)}catch(d){this.select.add(c)}this.limpio=false};SelectDependiente.prototype.buscarGrupoDesdeValor=function(a){var b=undefined;if(typeof this.dependiente==="object"&&this.ajax===true){this.params[this.varsoloref]=true;this.params[this.varref]=a;jQuery.ajax({url:this.url,data:this.params,type:"POST",async:false,dataType:"json",context:this,success:function(a){if(typeof a!=="undefined"){b=a}}})}else{for(var c in this.opciones){for(var d in this.opciones[c]){if(d==a){b=c}}}}return b};SelectDependiente.prototype.limpiar=function(a){var a=typeof a==="undefined"?false:a;var b=this.select.options.length;for(var c=0;c<b;++c){this.select.remove(0)}if(this.vacio!==false){this.agregarOpcion("",this.vacio)}this.limpio=true;this.grupo="";if(a===false){this.cambio()}};SelectDependiente.prototype.mostrar=function(a,b){this.select.disabled=true;var b=typeof b==="undefined"?false:b;if(this.limpio===false){this.limpiar(b)}if(typeof a!=="undefined"&&a.toString().length==0){a=undefined}if(typeof a==="undefined"&&typeof this.dependiente==="object"){if(this.dependiente.select.selectedIndex>=0){var c=this.dependiente.select.options[this.dependiente.select.selectedIndex].value;if(c.toString().length>0){a=c}}}if(typeof a!=="undefined"||this.ajax===true&&typeof this.dependiente!=="object"){this.grupo=a;if(this.ajax===true&&typeof jQuery!=="undefined"){if(!(this.cache===true&&typeof this.opciones[this.grupo]!=="undefined")){this.params[this.varsoloref]=false;this.params[this.varref]=a;jQuery.ajax({url:this.url,data:this.params,type:"POST",async:false,dataType:"json",context:this,success:function(a){this.opciones[this.grupo]=a}})}}for(var c in this.opciones[this.grupo]){this.agregarOpcion(c,this.opciones[this.grupo][c])}}if(b===false&&this.select.options.length>0){this.select.selectedIndex=0;this.cambio(this.select.options[this.select.selectedIndex].value)}this.select.disabled=false;return this};SelectDependiente.prototype.mostrarDependiente=function(a,b){this.mostrar(a,b);if(typeof this.dependiente==="object"){this.dependiente.mostrar(this.dependiente.buscarGrupoDesdeValor(a),true);this.dependiente.seleccionar(a,true)}};SelectDependiente.prototype.seleccionar=function(a,b){var b=typeof b==="undefined"?false:b;for(i=0;i<this.select.options.length;i++){if(this.select.options[i].value==a){this.select.selectedIndex=i;if(b===false){this.cambio(a)}break}}if(typeof this.dependiente==="object"){this.dependiente.mostrar(this.dependiente.buscarGrupoDesdeValor(this.grupo),true);this.dependiente.seleccionar(this.grupo,true)}}